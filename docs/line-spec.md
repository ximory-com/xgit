# XGit Line æŒ‡ä»¤é›† v0.1ï¼ˆè‰æ¡ˆï¼‰

## ç›®æ ‡

åœ¨ä¸ä¾èµ– `git diff` çš„å‰æä¸‹ï¼Œå®Œæˆ**è¡Œçº§åˆ«**çš„æ’å…¥ / æ›¿æ¢ /
åˆ é™¤ç­‰æ“ä½œï¼›é”šç‚¹ç¨³å®šã€é¡ºåºå¯æ§ã€å¹‚ç­‰ã€å®‰å…¨å¯å›æ»šã€‚

------------------------------------------------------------------------

## é€šç”¨è§„åˆ™

-   **è¯­æ³•å¤–å£³**ï¼šä½¿ç”¨ä½ å·²å®šçš„è¡¥ä¸åŒ…è£¹è§„èŒƒï¼ˆå¤´ä¸º
    `=== line.xxx: "<path>" ===`ï¼Œå‚æ•°åœ¨ body çš„ KV
    åŒºï¼Œæ­£æ–‡ä¸ºè´Ÿè½½æ–‡æœ¬ï¼Œ`=== end ===` ç»“æŸï¼Œæœ«å°¾ `=== PATCH EOF ===`ï¼‰ã€‚
-   **å®šä½**ï¼šäºŒé€‰ä¸€
    1)  `lineno>0` â†’ ç›´æ¥å®šä½ï¼›\
    2)  `lineno=0`ï¼ˆé»˜è®¤ï¼‰â†’ ä½¿ç”¨ `keys`ï¼ˆå®½æ¾ AND
        åŒ¹é…ï¼‰å”¯ä¸€å®šä½åˆ°**ä¸€è¡Œ**ã€‚
-   **åŒ¹é…ï¼ˆkeysï¼‰**ï¼šå¿½ç•¥å¤§å°å†™(`icase=1`)ã€å¿½ç•¥è¡Œé¦–ç¼©è¿›ï¼ˆè‡ªåŠ¨
    `TrimLeft` ç©ºç™½åæ¯”è¾ƒï¼‰ã€‚å½“ `keys`
    å¤šå€¼æ—¶ï¼Œè¦æ±‚**åŒä¸€è¡ŒåŒæ—¶åŒ…å«å…¨éƒ¨å…³é”®å­—**ï¼ˆANDï¼‰ã€‚
    -   `keys` å¤šå€¼å¯ç”¨ï¼š
        -   å•è¡Œï¼š`keys=a|b|c`\
        -   é‡å¤é”®ï¼šå¤šè¡Œ `keys=...`\
        -   å¤šè¡Œå—ï¼š`keys< ... >keys`ï¼ˆæ¯è¡Œä¸€ä¸ªï¼Œé¦–è¡ŒåŠ ç©ºæ ¼ï¼‰
-   **é¡ºåº**ï¼šæŒ‰è¡¥ä¸ä¸­å‡ºç°çš„é¡ºåºä¾æ¬¡æ‰§è¡Œï¼ˆä¸€ä¸ªæ“ä½œå†™ç›˜åï¼Œä¸‹ä¸€ä¸ªè¯»å–æœ€æ–°æ–‡ä»¶ï¼‰ã€‚
-   **å†²çª**ï¼šé»˜è®¤**ä¸åšå†²çªæ£€æµ‹**ï¼ˆé¡ºåºå³çœŸç†ï¼‰ã€‚å¦‚éœ€ä¸¥æ ¼ï¼š`strict=1` â†’
    åŒä¸€æ–‡ä»¶åŒä¸€ç›®æ ‡è¡Œ/é‡å æ“ä½œæŠ¥é”™ã€‚
-   **æ¢è¡Œ**ï¼š`ensure_nl=1`ï¼ˆé»˜è®¤ï¼‰â†’ å†™å›æ—¶å¼ºåˆ¶æœ«å°¾æ¢è¡Œã€‚
-   **å¹‚ç­‰**ï¼š
    -   `insert_*` å¦‚æ’å…¥å†…å®¹å·²å­˜åœ¨äºç›®æ ‡ä½ç½® â†’ è®° `â„¹ï¸ å·²å­˜åœ¨ï¼Œè·³è¿‡`ã€‚\
    -   `replace_*` æ–°æ—§ä¸€è‡´ â†’ `allow_noop=1` è§†ä¸ºæˆåŠŸï¼Œå¦åˆ™æŠ¥
        `â„¹ï¸ æ— å˜åŒ–` å¹¶è·³è¿‡/æˆåŠŸï¼ˆå®ç°å±‚å¯é€‰å…¶ä¸€ï¼‰ã€‚\
    -   `delete_*` ç›®æ ‡ä¸å­˜åœ¨ â†’ é»˜è®¤æŠ¥é”™ï¼›`allow_noop=1` æ—¶è·³è¿‡ã€‚
-   **æ—¥å¿—**ï¼šæ§åˆ¶å° = patch.log
    é•œåƒï¼›æ¯æ¡æ“ä½œæ‰“å°ï¼š`æ“ä½œå æ–‡ä»¶:è¡Œ å½±å“è¡Œæ•° (+/-N)`ã€‚

------------------------------------------------------------------------

## æŒ‡ä»¤æ¸…å•

### 1) `line.insert_before: "<path>"`

åœ¨ç›®æ ‡è¡Œ**ä¹‹å‰**æ’å…¥æ­£æ–‡ã€‚ - **å®šä½**ï¼š`lineno` æˆ– `keys` -
**æ­£æ–‡**ï¼šæ’å…¥çš„å¤šè¡Œæ–‡æœ¬ - **ç¤ºä¾‹** \`\`\` === line.insert_before:
"apps/web/web.css" === keys\< /\* XGit overrides \*/ \>keys icase=1
ensure_nl=1

:root{--brand:#2563eb} === end === \`\`\`

### 2) `line.insert_after: "<path>"`

åœ¨ç›®æ ‡è¡Œ**ä¹‹å**æ’å…¥æ­£æ–‡ã€‚ - ç”¨æ³•åŒä¸Šã€‚

### 3) `line.replace_line: "<path>"`

å°†**æ•´è¡Œ**æ›¿æ¢æˆæ­£æ–‡ã€‚ - æ­£æ–‡ï¼šæ›¿æ¢åçš„"å•è¡Œæˆ–å¤šè¡Œ"ï¼ˆé€šå¸¸ 1 è¡Œï¼‰ - ç¤ºä¾‹
\`\`\` === line.replace_line: "apps/web/index.html" === keys\< XGit Web
App \>keys icase=1

```{=html}
<title>
```
XGit
```{=html}
</title>
```
=== end === \`\`\`

### 4) `line.delete_line: "<path>"`

åˆ é™¤ç›®æ ‡è¡Œï¼ˆæ•´è¡Œç§»é™¤ï¼‰ã€‚ - `allow_noop=1` å¯åœ¨æœªå‘½ä¸­æ—¶é™é»˜è·³è¿‡ã€‚

> ä»¥ä¸Šå››ä¸ªè¦†ç›– 80% ä¿®æ”¹ç±»éœ€æ±‚ã€‚ä¸‹é¢æ˜¯"åŒºé—´ç±»"å¯é€‰é¡¹ï¼ˆå¯åç»­å®ç°ï¼‰ã€‚

### 5) `line.replace_range: "<path>"`ï¼ˆå¯é€‰ï¼‰

å°† `[start..end]` åŒºé—´æ›¿æ¢ä¸ºæ­£æ–‡ã€‚ -
å‚æ•°ï¼š`start`ã€`end`ï¼ˆäºŒé€‰ä¸€ï¼šæ˜¾å¼è¡Œå·ï¼›æˆ– `start_keys`/`end_keys`
é”šç‚¹å”¯ä¸€å‘½ä¸­ï¼‰ - ä½¿ç”¨åœºæ™¯ï¼šå°å‡½æ•°/å°æ®µæ¨¡æ¿æ•´ä½“æ›¿æ¢ã€‚

### 6) `line.delete_range: "<path>"`ï¼ˆå¯é€‰ï¼‰

åˆ é™¤ `[start..end]` åŒºé—´ã€‚ - å‚æ•°åŒä¸Šï¼Œæ”¯æŒ `allow_noop=1`ã€‚

------------------------------------------------------------------------

## å‚æ•°ä¸€è§ˆï¼ˆæ‰§è¡Œå±‚è¯»å–è‡ª `Args`ï¼‰

-   `lineno`ï¼ˆé»˜è®¤ 0ï¼‰\
-   `keys`ï¼ˆå¤šå€¼ï¼›ANDï¼›è§"åŒ¹é…"ï¼‰\
-   `icase`ï¼ˆé»˜è®¤ 1ï¼‰\
-   `ensure_nl`ï¼ˆé»˜è®¤ 1ï¼‰\
-   `allow_noop`ï¼ˆé»˜è®¤ 0ï¼‰\
-   `strict`ï¼ˆé»˜è®¤ 0ï¼‰\
-   ï¼ˆå¯é€‰ï¼‰`preview`ï¼ˆ1ï¼šä»…é¢„è§ˆï¼Œä¸è½ç›˜ï¼›å°†ä¼šæ‰“å°å®šä½ç»“æœä¸ unified
    diffï¼‰

------------------------------------------------------------------------

## åŒ¹é…ç»†èŠ‚

-   é¢„å¤„ç†ï¼šå–ç›®æ ‡æ–‡ä»¶æ¯ä¸€è¡Œçš„**æ–‡æœ¬å‰¯æœ¬**åšåŒ¹é…ï¼š`strings.TrimLeft(line, "    ")`ï¼Œå†åšå¤§å°å†™ç»Ÿä¸€ï¼ˆå½“
    `icase=1`ï¼‰ã€‚\
-   å‘½ä¸­è§„åˆ™ï¼š
    -   å•å€¼ï¼šè¯¥è¡ŒåŒ…å«å­ä¸² `keys`ã€‚\
    -   å¤šå€¼ï¼šåŒä¸€è¡ŒåŒ…å«æ‰€æœ‰å­ä¸²ï¼ˆANDï¼‰ã€‚\
-   è®¡æ•°ï¼š
    -   **0 å‘½ä¸­**ï¼šæŠ¥é”™å¹¶æ‰“å°é‡‡æ ·ï¼ˆå‰å Â±2 è¡Œï¼‰ã€‚\
    -   **\>1 å‘½ä¸­**ï¼šæŠ¥é”™å¹¶æ‰“å°å‰ 5 ä¸ªå‘½ä¸­è¡Œå·ï¼Œå»ºè®®åŠ å…³é”®å­—æˆ–æ”¹ç”¨
        `lineno`ã€‚

------------------------------------------------------------------------

## æ‰§è¡Œé¡ºåºä¸åç§»

-   æ¯æ¡æ“ä½œ**ç«‹å³å†™å›**ï¼Œä¸‹ä¸€æ¡åŸºäºæœ€æ–°æ–‡ä»¶ã€‚\
-   å¦‚éœ€"åŒæ–‡ä»¶å†…ä¸€æ¬¡æ€§å¤šæ“ä½œå¹¶é¿å…åç§»"ï¼Œå¯åœ¨å®ç°å±‚æä¾›
    `mode=batch`ï¼šåŒæ–‡ä»¶è®¡åˆ’åˆå¹¶å**æŒ‰è¡Œå·é™åº**æ‰§è¡Œï¼ˆå¯ç•™ä½œæ‰©å±•ï¼‰ã€‚

------------------------------------------------------------------------

## æ—¥å¿—è§„èŒƒï¼ˆå»ºè®®ï¼‰

-   å®šä½é˜¶æ®µï¼š
    -   `ğŸ” é”šç‚¹ apps/web/index.html keys="</header>" -> L=37 (icase=1)`\
    -   `âš ï¸ å¤šå‘½ä¸­ 3 å¤„ï¼šL=37, 89, 120`
-   æ‰§è¡Œé˜¶æ®µï¼š
    -   `â• insert_after apps/web/index.html:L37 (+3)`\
    -   `âœï¸ replace_line apps/web/index.html:L10 (1â†’1)`\
    -   `ğŸ—‘ï¸ delete_line apps/web/index.html:L58 (-1)`
-   äº‹åŠ¡ï¼š
    -   `âœ… é¢„æ£€é€šè¿‡` / `âŒ å¤±è´¥å¹¶å›æ»š`

------------------------------------------------------------------------

## ç¤ºä¾‹è¡¥ä¸ï¼ˆæ··åˆæ“ä½œï¼‰

    repo: xgit
    commitmsg: feat(web): header tidy, add site nav, cap hero logo
    author: XGit Bot <bot@xgit.local>

    === line.replace_line: "apps/web/index.html" ===
    keys<
     XGit
     Web App
    >keys
    icase=1

    <title>XGit</title>
    === end ===

    === line.insert_after: "apps/web/index.html" ===
    keys=</header>
    icase=1

    <nav class="nav">
      <a class="link-site" href="https://xgit.ximory.com">è¿”å›å®˜ç½‘</a>
    </nav>
    === end ===

    === line.insert_before: "apps/web/web.css" ===
    lineno=1

    /* XGit overrides */
    :root{--brand:#2563eb}
    .nav{display:flex;justify-content:flex-end;margin:8px 0 16px}
    .link-site{color:var(--brand);text-decoration:none}
    .link-site:hover{text-decoration:underline}
    === end ===

    === PATCH EOF ===

------------------------------------------------------------------------

## æµ‹è¯•å»ºè®®

1)  å•å‘½ä¸­ / å¤šå‘½ä¸­ / æœªå‘½ä¸­\
2)  å¤§å°å†™å·®å¼‚ / ç¼©è¿›å·®å¼‚\
3)  æ’å…¥å‰åå¹‚ç­‰ï¼ˆé‡å¤æ‰§è¡Œä¸è„æ•°æ®ï¼‰\
4)  `allow_noop` åˆ†æ”¯\
5)  `strict=1` å†²çªæ£€æµ‹\
6)  å›æ»šï¼šä¸­é€”ä¸€æ¡å¤±è´¥ï¼Œå‰é¢æ”¹åŠ¨è¢«æ’¤å›
